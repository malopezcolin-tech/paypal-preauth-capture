<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ðŸ’³ Pago con PreautorizaciÃ³n</title>
</head>
<body>
  <h2>ðŸ’³ Pago con PreautorizaciÃ³n</h2>

  <label for="amount">Monto a pagar (USD):</label>
  <input id="amount" type="number" value="10.00" step="0.01" />

  <h3>O paga con PayPal</h3>
  <div id="paypal-button-container"></div>

  <h3>O paga con tarjeta</h3>
  <div id="card-fields"></div>
  <div id="card-errors" style="color:red"></div>
  <button id="pay-card-btn">Autorizar pago con tarjeta</button>

  <script src="https://www.paypal.com/sdk/js?client-id=AQipbXia4TEIQOiol5Q7ZMkpJOBM5grLZDuQOOYd6HvUG16a7pK0a_NndaRsorh9oD98QIhbYtEC1Tww&components=buttons,hosted-fields&intent=authorize"></script>
  <script>
    // BotÃ³n PayPal
    paypal.Buttons({
      createOrder: function() {
        return fetch("/create-order", { method: "post" })
          .then(res => res.json())
          .then(order => order.id);
      },
      onApprove: function(data) {
        return fetch(`/capture-order/${data.orderID}`, { method: "post" })
          .then(res => res.json())
          .then(details => {
            alert("Preautorizado: " + JSON.stringify(details, null, 2));
          });
      }
    }).render("#paypal-button-container");

    // Hosted Fields para tarjeta
    paypal.HostedFields.render({
      createOrder: () => {
        return fetch("/create-order", { method: "post" })
          .then(res => res.json())
          .then(order => order.id);
      },
      styles: {
        'input': { 'font-size': '16px', 'color': '#3A3A3A' }
      },
      fields: {
        number: { selector: "#card-fields", placeholder: "NÃºmero de tarjeta" },
        cvv: { selector: "#card-fields", placeholder: "CVV" },
        expirationDate: { selector: "#card-fields", placeholder: "MM/AA" }
      }
    }).then((hf) => {
      document.getElementById("pay-card-btn").addEventListener("click", () => {
        hf.submit().then((payload) => {
          alert("Pago con tarjeta preautorizado: " + JSON.stringify(payload, null, 2));
        }).catch(err => {
          document.getElementById("card-errors").innerText = err.message;
        });
      });
    });
  </script>
</body>
</html>